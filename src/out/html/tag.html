<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="SHORTCUT ICON" href="./img/icon.jpg">

    <title>分类</title>

    <link rel="stylesheet" href="css/deploy.min.css">

    <script src="js/jquery.min.js"></script>
    <script src="js/custom.min.js"></script>
</head>

<body>

    <div class="nav">
    <div class="container">
        <div class="icon">
            <a href="./index.html">
                <img id="avatar" src="img/icon.jpg">
            </a>
        </div>
        <div class="list">
            <ul class="nav-list">
                <li class="nav-list-item">
                    <a href="./index.html">首页</a>
                </li>
                <li class="nav-list-item">
                    <a href="./about.html">关于我</a>
                </li>
                <li class="nav-list-item">
                    <a href="http://u4813096.viewer.maka.im/k/OQHMX6E6?from=timeline">狗粮合集</a>
                </li>
            </ul>
        </div>
    </div>
</div>

    <div id="tagInfo">
        <div id="info" class="container">
        </div>
    </div>

    <div id="index" class="indexList container">
    </div>

    <script>
        /* 获取并设定页面标题 */
        var targetTag = getParaValue("tag");
        if (targetTag == null || targetTag === '') {
            window.location.href = "./index.html"
        }
        $("title").html("标签：" + targetTag);

        var postHeader = $("<h1></h1>", {
            text: 'Tag: ' + targetTag
        });
        var info = $("#info");
        postHeader.appendTo(info);

        /* 获取包含制定 tag 的博客信息 */
        var requestedPosts = [];
        $.ajax("description.json").done(function (data) {
            var posts = data.posts;
            var tags = [];
            posts.forEach(post => {
                tags = post.tag.split(", ");
                tags.forEach(tag => {
                    tag = tag.trim();
                });
                if (tags.indexOf(targetTag) >= 0) {
                    requestedPosts.push(post);
                }
            });
            requestedPosts = requestedPosts.sort(by("date"));

            if (posts == null) {
                new RedirectTo404();
            }

            var index = $("#index");

            for (var i = 0; i < requestedPosts.length; i++) {
                var indexItem = $("<div></div>", {
                    class: "indexItem"
                });

                var date = $("<div></div>", {
                    class: "date",
                    text: requestedPosts[i].date
                });
                date.appendTo(indexItem);
                var title = $("<a></a>", {
                    href: "./post.html?name=" + requestedPosts[i].name
                });
                var header = $("<h1></h1>", {
                    text: requestedPosts[i].title
                });
                header.appendTo(title);
                title.appendTo(indexItem);

                var description = $("<div></div>", {
                    class: "description",
                    text: requestedPosts[i].description
                });
                var readMore = $("<div></div>", {
                    class: "readMore"
                });
                var link = $("<a></a>", {
                    href: "./post.html?name=" + requestedPosts[i].name,
                    text: "阅读原文..."
                });
                link.appendTo(readMore);
                readMore.appendTo(description);
                description.appendTo(indexItem);

                var tagList = $("<div></div>", {
                    class: "tagList"
                });

                for (var j = 0; j < tags.length; j++) {
                    var tagItem = $("<div></div>", {
                        class: "tagItem " + colors[j]
                    });
                    var tagLink = $("<a></a>", {
                        href: "./tag.html?tag=" + tags[j],
                        text: tags[j]
                    });
                    tagLink.appendTo(tagItem);
                    tagItem.appendTo(tagList);
                }
                tagList.appendTo(indexItem);
                indexItem.appendTo(index);
            }
        });
    </script>

    <div id='toTop' title="返回顶部">
        <div class="arrow"></div>
        <div class="stick"></div>
    </div>

    <div class="footer">
    <p>Copyright © 2014 - 2018 stormlin.</p>
    <p>All Rights Reserved.</p>
    <p>
        <a href="http://www.miitbeian.gov.cn">备案号：粤ICP备16029958号-1</a>
    </p>
</div>

</body>

</html>